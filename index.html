<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos Naturistas EnerGreen - Carrito</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="config.js"></script> 
    <style>
        /* Estilos para el bot√≥n flotante del carrito */
        #carrito-flotante {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
        }
        /* Animaci√≥n suave para el modal */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal { animation: fadeIn 0.3s ease-in-out; }

        /* Estilos del cuerpo para fondo: Ser√° sobreescrito por JS */
        body {
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat;
        }

        /* Estilos clave para el carrusel de productos/fichas */
        .carousel-container {
            /* Oculta la barra de desplazamiento nativa */
            -ms-overflow-style: none; 
            scrollbar-width: none; 
            scroll-behavior: smooth; 
            scroll-snap-type: x mandatory; 
        }
        .carousel-container::-webkit-scrollbar {
            display: none; 
        }

        .carousel-item {
            flex: 0 0 100%; 
            scroll-snap-align: start; 
        }

    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">

    <div id="promo-banner" class="bg-green-600 text-white text-center py-2 text-sm sm:text-lg font-semibold shadow-md">
    </div>

    <nav class="bg-white shadow-md">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center">
            <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-3">
                <img id="logo-img" src="" alt="Logo" class="h-16 sm:h-20 w-16 sm:w-20 object-contain">
                <h1 id="nombre-tienda" class="text-3xl sm:text-6xl font-serif text-green-700 text-center sm:text-left"></h1>
            </div>
            <ul class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 mt-4 sm:mt-0 text-gray-700 font-medium text-center">
                <li><a href="#inicio" class="hover:text-green-600">Inicio</a></li>
                <li><a href="#productos" class="hover:text-green-600">Productos</a></li>
                <li><a href="#contacto" class="hover:text-green-600">Contacto</a></li>
                <li><button id="abrir-carrito-menu" class="hover:text-green-600">üõí Carrito (<span id="contador-menu">0</span>)</button></li>
            </ul>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <input 
            type="text" 
            id="buscador" 
            placeholder="Busca tu producto..." 
            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"
        >
    </div>

    <header id="inicio" class="text-center py-6 px-4 sm:px-6">
        <h2 class="text-2xl sm:text-4xl font-extrabold text-green-700">Productos Naturistas</h2>
        <p class="text-gray-600 mt-2 text-sm sm:text-lg">¬°Bienestar natural, energ√≠a y salud para tu d√≠a a d√≠a!</p>
    </header>

    <section id="productos" class="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8 px-4 sm:px-6 lg:px-8">
    </section>

    <button id="carrito-flotante" 
            class="bg-gray-400 hover:bg-red-600 text-white py-3 px-5 rounded-full text-2xl font-semibold shadow-2xl transition transform hover:scale-110">
        üõí <span id="contador-flotante">0</span>
    </button>

    <div id="contacto" class="text-center my-8 sm:my-12 px-4">
        <a id="contacto-wa" href="" target="_blank"
            class="bg-green-500 hover:bg-green-600 text-white py-3 px-6 sm:px-8 rounded-full text-base sm:text-xl font-semibold shadow-lg transition">
            üí¨ Cont√°ctanos por WhatsApp
        </a>
    </div>

    <footer class="bg-green-700 text-white text-center py-6 px-4">
        <p class="text-sm">¬© 2025 Renacer Natural | Todos los derechos reservados</p>
        <p class="text-xs mt-1">Sitio desarrollado por Dylan Miramontes Gomez</p>
    </footer>

    <div id="modal-carrito" class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg overflow-hidden max-h-[90vh] flex flex-col">
            
            <div class="bg-green-700 text-white p-4 flex justify-between items-center">
                <h3 class="text-xl font-bold">üõí Carrito de Compras</h3>
                <button id="cerrar-carrito" class="text-2xl font-bold leading-none hover:text-red-300">√ó</button>
            </div>

            <div id="seccion-carrito" class="p-4 flex-grow overflow-y-auto">
                <ul id="lista-carrito" class="space-y-4">
                    <li class="text-center text-gray-500 py-4">Tu carrito est√° vac√≠o.</li>
                </ul>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <p class="text-lg font-semibold flex justify-between">
                        Total: <span id="total-carrito" class="text-green-600">$0.00 MXN</span>
                    </p>
                    <button id="btn-iniciar-compra" 
                            class="w-full mt-4 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold transition disabled:opacity-50"
                            disabled>
                        Continuar con el Env√≠o
                    </button>
                </div>
            </div>

            <div id="seccion-envio" class="p-4 hidden flex-grow overflow-y-auto">
                <h4 class="text-xl font-bold mb-4 text-green-700">Detalles del Env√≠o</h4>
                <form id="formulario-envio" class="space-y-4">
                    <input type="text" id="nombre" placeholder="Nombre completo" required class="w-full p-2 border rounded">
                    <input type="text" id="calle" placeholder="Calle" required class="w-full p-2 border rounded">
                    <div class="flex space-x-2">
                        <input type="text" id="num_ext" placeholder="No. Exterior" required class="w-1/2 p-2 border rounded">
                        <input type="text" id="num_int" placeholder="No. Interior (Opcional)" class="w-1/2 p-2 border rounded">
                    </div>
                    <input type="text" id="colonia" placeholder="Colonia" required class="w-full p-2 border rounded">
                    <input type="text" id="municipio" placeholder="Municipio/Alcald√≠a" required class="w-full p-2 border rounded">
                    <input type="text" id="codigo_postal" placeholder="C√≥digo Postal" required class="w-full p-2 border rounded">
                    <input type="tel" id="telefono" placeholder="Tel√©fono WhatsApp (ej. 52XXXXXXXXXX)" required class="w-full p-2 border rounded">
                    
                    <button type="submit" id="btn-comprar-final"
                            class="w-full mt-6 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold transition">
                        Comprar y Pagar (Generar Mensaje con Datos de Pago)
                    </button>
                </form>
                <button id="btn-volver-carrito" class="w-full mt-2 text-sm text-gray-600 hover:text-green-700">
                    ‚Üê Volver al carrito
                </button>
            </div>

        </div>
    </div>
    
    <script>
        // =========================================================================
        // --- SECCI√ìN DE L√ìGICA CENTRAL DE LA TIENDA ---
        // =========================================================================

        let carrito = []; 

        // Referencias a elementos del DOM
        const modalCarrito = document.getElementById('modal-carrito');
        const listaCarrito = document.getElementById('lista-carrito');
        const totalCarrito = document.getElementById('total-carrito');
        const btnIniciarCompra = document.getElementById('btn-iniciar-compra');
        const contadorFlotante = document.getElementById('contador-flotante');
        const contadorMenu = document.getElementById('contador-menu');
        const seccionCarrito = document.getElementById('seccion-carrito');
        const seccionEnvio = document.getElementById('seccion-envio');
        const formularioEnvio = document.getElementById('formulario-envio');
        const productosContainer = document.getElementById('productos');
        const buscador = document.getElementById('buscador');


        // --- 1. L√ìGICA DEL CARRITO (A√±adir, Quitar, Renderizar) ---

        function actualizarContadores() {
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            contadorFlotante.textContent = totalItems;
            contadorMenu.textContent = totalItems;
            btnIniciarCompra.disabled = totalItems === 0;
            // Cambia el color del bot√≥n flotante si hay items
            if (totalItems > 0) {
                document.getElementById('carrito-flotante').classList.replace('bg-gray-400', 'bg-red-500');
            } else {
                document.getElementById('carrito-flotante').classList.replace('bg-red-500', 'bg-gray-400');
            }
        }

        function renderizarCarrito() {
            listaCarrito.innerHTML = '';
            let total = 0;

            if (carrito.length === 0) {
                listaCarrito.innerHTML = '<li class="text-center text-gray-500 py-4">Tu carrito est√° vac√≠o.</li>';
                totalCarrito.textContent = '$0.00 MXN';
                actualizarContadores();
                return;
            }

            carrito.forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;

                const li = document.createElement('li');
                li.className = 'flex items-center justify-between border-b pb-2';
                li.innerHTML = `
                    <div class="flex flex-col flex-grow">
                        <span class="font-semibold text-sm">${item.nombre}</span>
                        <span class="text-xs text-gray-500">$${item.precio.toFixed(2)} c/u</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button data-index="${index}" class="btn-restar text-red-500 hover:text-red-700 px-2 py-1 border rounded-full text-xs">-</button>
                        <span class="font-bold text-sm">${item.cantidad}</span>
                        <button data-index="${index}" class="btn-sumar text-green-500 hover:text-green-700 px-2 py-1 border rounded-full text-xs">+</button>
                        <button data-index="${index}" class="btn-eliminar-item text-gray-400 hover:text-red-500 ml-3 text-lg leading-none">√ó</button>
                    </div>
                `;
                listaCarrito.appendChild(li);
            });

            totalCarrito.textContent = `$${total.toFixed(2)} MXN`;
            actualizarContadores();
        }

        function handleAddToCart(e) {
            const productoDiv = e.target.closest('.producto');
            const id = productoDiv.dataset.id;
            const nombre = productoDiv.dataset.nombre;
            const precio = parseFloat(productoDiv.dataset.precio);

            const itemExistente = carrito.find(item => item.id === id);

            if (itemExistente) {
                itemExistente.cantidad++;
            } else {
                carrito.push({ id, nombre, precio, cantidad: 1 });
            }
            
            renderizarCarrito();
            alert(`"${nombre}" a√±adido al carrito. Total: ${carrito.reduce((sum, item) => sum + item.cantidad, 0)} pzas.`);
        }
        
        // Manejadores de eventos para Carrito (sumar, restar, eliminar)
        listaCarrito.addEventListener('click', (e) => {
            const index = e.target.dataset.index;
            if (index === undefined) return; // Evita errores si se hace clic fuera de los botones

            if (e.target.classList.contains('btn-sumar')) {
                carrito[index].cantidad++;
            } else if (e.target.classList.contains('btn-restar')) {
                if (carrito[index].cantidad > 1) {
                    carrito[index].cantidad--;
                }
            } else if (e.target.classList.contains('btn-eliminar-item')) {
                carrito.splice(index, 1);
            }
            renderizarCarrito();
        });


        // --- 2. GESTI√ìN DEL MODAL Y NAVEGACI√ìN ---
        
        // Abrir/Cerrar Carrito
        document.getElementById('carrito-flotante').addEventListener('click', () => modalCarrito.classList.remove('hidden'));
        document.getElementById('abrir-carrito-menu').addEventListener('click', () => modalCarrito.classList.remove('hidden'));
        document.getElementById('cerrar-carrito').addEventListener('click', () => {
            modalCarrito.classList.add('hidden');
            seccionCarrito.classList.remove('hidden');
            seccionEnvio.classList.add('hidden');
        });

        // Navegaci√≥n entre secciones
        btnIniciarCompra.addEventListener('click', () => {
            seccionCarrito.classList.add('hidden');
            seccionEnvio.classList.remove('hidden');
        });

        document.getElementById('btn-volver-carrito').addEventListener('click', () => {
            seccionEnvio.classList.add('hidden');
            seccionCarrito.classList.remove('hidden');
        });


        // --- 3. L√ìGICA DE COMPRA Y WHATSAPP (SEMI-MANUAL) ---

formularioEnvio.addEventListener('submit', (e) => {
    e.preventDefault();

    // 1. Recopilar datos del formulario
    const datosEnvio = {
        nombre: document.getElementById('nombre').value,
        calle: document.getElementById('calle').value,
        num_ext: document.getElementById('num_ext').value,
        num_int: document.getElementById('num_int').value,
        colonia: document.getElementById('colonia').value,
        municipio: document.getElementById('municipio').value,
        codigo_postal: document.getElementById('codigo_postal').value,
        telefono: document.getElementById('telefono').value,
    };

    // 2. Generar el resumen del pedido y total
    let total = 0;
    let resumenProductos = '';
    const orderID = `WEB-${Date.now().toString().slice(-8)}`; 

    carrito.forEach(item => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;
        resumenProductos += ` - ${item.nombre} (x${item.cantidad}) - $${subtotal.toFixed(2)} MXN\r\n`;
    });
    
    // *** MODIFICACI√ìN CLAVE: Se ELIMINA la definici√≥n de datosBancarios ***
    
    // 3. Frase clave para el disparador de la auto-respuesta
    const solicitudPago = `*TOTAL A PAGAR: $${total.toFixed(2)} MXN \r\n\r\n*¬°SOLICITO... DATOS DE PAGO!* Por favor, env√≠ame las instrucciones para transferir y completar mi pedido.`;


    // 4. Arma el mensaje final
    const mensajeWA = encodeURIComponent(
        `¬°NUEVO PEDIDO WEB! #${orderID}\n\n` +
        `*CLIENTE:*\n` +
        `Nombre: ${datosEnvio.nombre}\n` +
        `Tel√©fono: ${datosEnvio.telefono}\n\n` +
        `*DIRECCI√ìN DE ENV√çO:*\n` +
        `${datosEnvio.calle} #${datosEnvio.num_ext}` + 
        (datosEnvio.num_int ? ` Int. ${datosEnvio.num_int}` : '') + `\n` +
        `Colonia: ${datosEnvio.colonia}\n` +
        `Municipio: ${datosEnvio.municipio}\n` +
        `C.P.: ${datosEnvio.codigo_postal}\n\n` +
        `*DETALLE DEL PEDIDO:*\n${resumenProductos}\n` +
        '-----------------------------------\n' +
        solicitudPago // <-- Ahora solo se incluye la solicitud de pago
    );

    // 5. Abrir WhatsApp en una nueva pesta√±a
    const urlWhatsApp = `https://wa.me/${STORE_CONFIG.WHATSAPP_NUMERO}?text=${mensajeWA}`;
    window.open(urlWhatsApp, '_blank');
    
    // 6. Alerta de confirmaci√≥n al cliente (opcional)
    alert('¬°Pedido Enviado! Ser√°s redirigido a WhatsApp para enviar el mensaje con los datos de tu pedido y recibir los datos de pago.');

    // 7. Limpiar carrito y cerrar modal
    carrito = [];
    renderizarCarrito();
    modalCarrito.classList.add('hidden');
    formularioEnvio.reset();
});

        // C√≥digo para el modal de zoom de imagen (Ya existente)
        const modal = document.createElement('div');
        modal.id = 'modalImagen';
        modal.className =
          'hidden fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 p-4 overflow-auto';

        modal.innerHTML = `
          <div class="relative bg-transparent flex flex-col items-center justify-center">
            <img id="imagenAmpliada" 
                  src="" 
                  alt="Vista ampliada"
                  class="rounded-xl object-contain max-w-[90vw] max-h-[75vh] border-4 border-white shadow-2xl transition-transform duration-300 ease-in-out mb-6">
            <div class="flex space-x-3 fixed bottom-8 sm:static sm:bottom-auto">
              <button id="descargarBtn" 
                      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm sm:text-base font-semibold shadow-md">
                Descargar PNG
              </button>
              <button id="cerrarModal" 
                      class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm sm:text-base font-semibold shadow-md">
                Cerrar
              </button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);

        const imagenAmpliada = modal.querySelector('#imagenAmpliada');
        const cerrarModal = modal.querySelector('#cerrarModal');
        const descargarBtn = modal.querySelector('#descargarBtn');
        
        function handleImageZoom(e) {
            const img = e.target;
            imagenAmpliada.src = img.src;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
        }

        cerrarModal.addEventListener('click', () => {
          modal.classList.add('hidden');
          document.body.style.overflow = 'auto';
        });

        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
          }
        });

        descargarBtn.addEventListener('click', async () => {
          try {
            const response = await fetch(imagenAmpliada.src);
            const blob = await response.blob();
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = imagenAmpliada.src.split('/').pop(); 
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          } catch (error) {
            alert('Error al descargar la imagen');
          }
        });


        // --- 5. L√ìGICA DEL CARRUSEL DE IMAGEN/FICHA T√âCNICA ---

        function setupCarousels() {
            document.querySelectorAll('.btn-prev, .btn-next').forEach(button => {
                button.removeEventListener('click', handleCarouselClick);
                button.addEventListener('click', handleCarouselClick);
            });
        }
        
        function handleCarouselClick(e) {
            const productoDiv = e.target.closest('.producto');
            const carousel = productoDiv.querySelector('.carousel-container');
            
            if (!carousel) return;

            const itemWidth = carousel.offsetWidth; 
            
            if (e.target.classList.contains('btn-next')) {
                carousel.scrollLeft += itemWidth;
            } else if (e.target.classList.contains('btn-prev')) {
                carousel.scrollLeft -= itemWidth;
            }
        }


        // --- 6. FUNCI√ìN CENTRAL: GENERAR P√ÅGINA DESDE LA CONFIGURACI√ìN ---
        
        function buildPageContent() {
            
            // A. Aplicar Configuraci√≥n General
            document.getElementById('promo-banner').textContent = STORE_CONFIG.PROMOCION_TEXTO;
            document.getElementById('logo-img').src = STORE_CONFIG.LOGO_URL;
            document.getElementById('nombre-tienda').textContent = STORE_CONFIG.NOMBRE_TIENDA;
            document.body.style.backgroundImage = `url('${STORE_CONFIG.FONDO_URL}')`;
            document.getElementById('contacto-wa').href = `https://wa.me/${STORE_CONFIG.WHATSAPP_NUMERO}`;

            // B. Generar Productos
            productosContainer.innerHTML = ''; 

            STORE_CONFIG.PRODUCTOS_DISPONIBLES.forEach(p => {
                const productoHTML = `
                    <div class="producto bg-white rounded-2xl shadow-md overflow-hidden hover:shadow-lg transition p-4 sm:p-5 text-center relative flex flex-col justify-between"
                        data-id="${p.id}" 
                        data-nombre="${p.nombre}" 
                        data-precio="${p.precio}">
                        
                        <div class="relative">
                            <div class="carousel-container flex overflow-x-scroll snap-x snap-mandatory rounded-lg mb-4">
                                
                                <div class="carousel-item flex justify-center items-center">
                                    <img src="${p.imagenProducto}" alt="Producto ${p.id}" class="w-full h-auto max-h-64 sm:max-h-72 object-contain rounded-lg">
                                </div>
                                
                                <div class="carousel-item flex justify-center items-center">
                                    <img src="${p.imagenFicha}" alt="Ficha t√©cnica ${p.id}" class="w-full h-auto max-h-64 sm:max-h-72 object-contain rounded-lg cursor-pointer imagen-zoom">
                                </div>

                            </div>
                            
                            <button class="btn-prev absolute top-1/2 left-0 transform -translate-y-1/2 bg-black bg-opacity-40 text-white p-2 rounded-full ml-1 hover:bg-opacity-70 transition z-10" data-target="${p.id}">
                                &lt;
                            </button>
                            <button class="btn-next absolute top-1/2 right-0 transform -translate-y-1/2 bg-black bg-opacity-40 text-white p-2 rounded-full mr-1 hover:bg-opacity-70 transition z-10" data-target="${p.id}">
                                &gt;
                            </button>
                        </div>
                        <div class="flex flex-col flex-grow justify-end">
                            <h3 class="text-lg sm:text-xl font-semibold mb-1">${p.nombre}</h3>
                            <p class="precio-producto text-green-600 font-bold text-base sm:text-lg mb-2">$${p.precio.toFixed(2)} MXN</p>
                            <p class="text-xs sm:text-sm text-gray-500">${p.descripcionCorta}</p>
                            <button class="btn-anadir-carrito mt-3 w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg font-semibold transition">
                                ‚ûï A√±adir al Carrito
                            </button>
                        </div>
                    </div>
                `;
                productosContainer.insertAdjacentHTML('beforeend', productoHTML);
            });

            // C. Re-inicializar Eventos
            setupProductEventListeners(); 
            setupCarousels(); 
        }

        function setupProductEventListeners() {
            document.querySelectorAll('.btn-anadir-carrito').forEach(button => {
                button.removeEventListener('click', handleAddToCart); 
                button.addEventListener('click', handleAddToCart);
            });

            document.querySelectorAll('.imagen-zoom').forEach(img => {
                img.removeEventListener('click', handleImageZoom); 
                img.addEventListener('click', handleImageZoom);
            });
        }
        
        // Inicializar todas las funciones al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            // Aseg√∫rate de que la configuraci√≥n se carg√≥
            if (typeof STORE_CONFIG === 'undefined') {
                alert("Error: No se encontr√≥ el archivo config.js. Aseg√∫rate de que est√° en la misma carpeta.");
            } else {
                buildPageContent(); // Genera todo el contenido din√°mico
                renderizarCarrito(); // Carga el carrito vac√≠o/existente
            }
        });
        
    </script>
</body>
</html>